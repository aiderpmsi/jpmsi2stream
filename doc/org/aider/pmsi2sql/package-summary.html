<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_29) on Mon Jan 30 01:59:56 CET 2012 -->
<TITLE>
org.aider.pmsi2sql
</TITLE>

<META NAME="date" CONTENT="2012-01-30">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="org.aider.pmsi2sql";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Package</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-use.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-files/index-1.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;PREV PACKAGE&nbsp;
&nbsp;<A HREF="../../../org/aider/pmsi2sql/dbtypes/package-summary.html"><B>NEXT PACKAGE</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html?org/aider/pmsi2sql/package-summary.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="package-summary.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<H2>
Package org.aider.pmsi2sql
</H2>
Permet d'insérer des fichiers PMSI (RSF et RSS) dans une base de données PostgreSQL.
<P>
<B>See:</B>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#package_description"><B>Description</B></A>
<P>

<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Class Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../org/aider/pmsi2sql/pmsi2sql.html" title="class in org.aider.pmsi2sql">pmsi2sql</A></B></TD>
<TD>Entrée du programme permettant d'insérer un fichier pmsi dans la base de données adéquate.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../org/aider/pmsi2sql/Pmsi2SqlBaseOptions.html" title="class in org.aider.pmsi2sql">Pmsi2SqlBaseOptions</A></B></TD>
<TD>Permet de définirdes options et de renvoyer la connexion à la base de données Postgresql
 selon les arguments fournis.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../org/aider/pmsi2sql/pmsi2sqlcreate.html" title="class in org.aider.pmsi2sql">pmsi2sqlcreate</A></B></TD>
<TD>Classe principale du programme pmsi2sqlcreate qui permet de créer les
 tables pour utiliser l'application pmsi2sql</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../org/aider/pmsi2sql/Pmsi2SqlMainOptions.html" title="class in org.aider.pmsi2sql">Pmsi2SqlMainOptions</A></B></TD>
<TD>Rajoute les arguments suivants pour le lancement du programme :
 Fichier de PMSI
 
 <code>-f (--file) FILE</code>
 
 Définit le fichier PMSI  (type RSS v6 ou RSF nouvelle version) à insérer
 </TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../org/aider/pmsi2sql/PmsiReader.html" title="class in org.aider.pmsi2sql">PmsiReader</A></B></TD>
<TD>Classe de base permettant deux opérations :
 
  Création du schéma de base de données permettant d'insérer correctement les données issues d'un fichier PMSI
  Insertion d'un fichier PMSI dans la base de données
 
 Cette classe est abstraite et sert de canvas pour les classes qui réalisent réellement la lecture
 des fichiers.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../org/aider/pmsi2sql/PmsiRSFReader.html" title="class in org.aider.pmsi2sql">PmsiRSFReader</A></B></TD>
<TD>Classe étendant la classe abstraite de PmsiReader et permettant de lire un
 fichier RSF (version mars 2009).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../org/aider/pmsi2sql/PmsiRSSReader.html" title="class in org.aider.pmsi2sql">PmsiRSSReader</A></B></TD>
<TD>Classe étendant la classe abstraite de PmsiReader et permettant de lire un
 fichier RSS (version 116).</TD>
</TR>
</TABLE>
&nbsp;

<P>

<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Enum Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../org/aider/pmsi2sql/pmsi2sql.FileType.html" title="enum in org.aider.pmsi2sql">pmsi2sql.FileType</A></B></TD>
<TD>Enumération permettant d'indiquer quel lecteur a réussi à réaliser la lecture du fichier
 pmis (et donc de quel type de format le fichier est</TD>
</TR>
</TABLE>
&nbsp;

<P>

<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Exception Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../org/aider/pmsi2sql/PmsiFileNotInserable.html" title="class in org.aider.pmsi2sql">PmsiFileNotInserable</A></B></TD>
<TD>Classe d'exception indiquant une impossibilité à rendre persistant le
 fichier PMSI.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="15%"><B><A HREF="../../../org/aider/pmsi2sql/PmsiFileNotReadable.html" title="class in org.aider.pmsi2sql">PmsiFileNotReadable</A></B></TD>
<TD>Classe d'exception indiquant une impossibilité à lire le
 fichier PMSI.</TD>
</TR>
</TABLE>
&nbsp;

<P>
<A NAME="package_description"><!-- --></A><H2>
Package org.aider.pmsi2sql Description
</H2>

<P>
Permet d'insérer des fichiers PMSI (RSF et RSS) dans une base de données PostgreSQL. 

Deux applications sont générées :

<ul>
<li> pmsi2sqlcreate : crée les tables nécessaires à l'insertion des données de PMSI</li>
<li> pmsi2sql : insère un fichier PMSI (RSF ou RSS) dans la base de données ; le type de fichier est détecté de manière automatique</li>
</ul>

<h2>Package Specification</h2>

<ol class="niveau1">
  <li>Présentation générale de la solution</li>
        <ol class="niveau2">
          <li>Langage de programmation : JAVA</li>
        Permet de s'interfacer avec les servlets, multiplateforme.
          <li>Base de données : Postgresql</li>
        Très bonne compliance au standard SQL, nombreuses fonctionnalités simplifiant le développement.
          <li>Absence de fichiers de configuration</li>
            Permet de définir tous les paramètres en ligne de commande. Attention, risque de sécurité car le mot de passe de la bd peut apparaitre dans la liste des processus.
    </ol>

  <li>Spécifications fonctionnelles</li>
        Permet d'insérer des données d'un RSS version 6 ou d'un RSF type nouveau format dans une base de données PostgreSQL
        afin de permettre des requêtes personnalisées et l'utilisation d'outils de reporting. 
        <ol class="niveau2">
          <li>Environnement à utiliser</li>
        <div>
            La connexion à la base de données se fait de manière non sécurisée, le mot de passe peut se voir dans la
        liste des processus, il faut donc utiliser un environnement sécurisé avec des utilisateurs formés.
        </div>
        <div>
        La version de java utilisée pour le développement est java 1.6 ; toute autre version 6 de java devrait
        fonctionner, mais ce n'est pas testé.
        </div>
        <div>
        La version de postgresql utilisée pour le développement est la 9.1, mais toute version supérieure ou
        égale à la 9.0 devrait fonctionner. La base de données dans laquelle les données vont être insérées
        et l'utilisateur de la base de données doivent être créés en dehors de l'application avec les outils
        d'administration adéquats (par exemple pgadminIII).
        </div>
      <li>Exécution de l'application</li>
        Il existe deux exécutables : jpmsi2sqlcreate crée les tables dans la base de données, et
        jpmsi2sql insère les données d'un fichier pmsi dans ces tables de la base de données. jpmsi2sqlcreate.jar
        doit donc être appelé avant toute insertion de données.
        L'application peut être lancée dans n'importe quel répertoire.
        <ol class="niveau3">
          <li>jpmsi2sqlcreate.jar</li>
            Exécuter jpmsi2sqlcreate.jar avec l'argument <code>-h</code> affiche la liste des paramètres de l'application :
            <code><br/>
C:\Documents and Settings\delabre\Mes documents>java -jar jpmsi2sqlcreate.jar -h<br/>
 -dbh (--dbhost) HOST    : Specifie l'hôte de la base de données<br/>
 -dbn (--dbname) NAME    : Specifie le nom de la base de données à utiliser<br/>
 -dbp (--dbpassword) PWD : Specifie le mot de passe de l'utilisateur<br/>
 -dbu (--dbuser) USER    : Specifie l'utilisateur de la base de données<br/>
 -h (--help)             : Affiche l'aide<br/>
 -l (--logfile) FILE     : Specifie le fichier de trace (non utilisé)<br/>
 -p (--port) PORT        : Specifie le port de la base de données<br/>
 -v (--version)          : Affiche la version<br/>
                </code>
                Le schéma de base de données généré ne sera pas entièrement complet, mais permettra d'insérer
                les données des RSF et RSS dans la base de données. Il manquera la fonction d'historisation
                à rajouter par un script sql manuellement.
              <li>pmsi2sql.jar</li>
                Exécuter jpmsi2sql.jar avec l'argument <code>-h</code> affiche la liste des paramètres de l'application :
                <code><br/>
C:\Documents and Settings\delabre\Mes documents>java -jar jpmsi2sql.jar -h<br/>
 -dbh (--dbhost) HOST    : Specifie l'hôte de la base de données<br/>
 -dbn (--dbname) NAME    : Specifie le nom de la base de données à utiliser<br/>
 -dbp (--dbpassword) PWD : Specifie le mot de passe de l'utilisateur<br/>
 -dbu (--dbuser) USER    : Specifie l'utilisateur de la base de données<br/>
 -f (--file) FILE        : Specifie le fichier de PMSI à insérer<br/>
 -h (--help)             : Affiche l'aide<br/>
 -l (--logfile) FILE     : Specifie le fichier de trace (non utilisé)<br/>
 -p (--port) PORT        : Specifie le port de la base de données<br/>
 -v (--version)          : Affiche la version<br/>
            </code>
                L'insertion d'un RSF ou RSS dans la base de données se fait en indiquant le chemin du
                fichier à l'argument <code>-f</code>. Le type de fichier pmsi est détecté de manière automatique.
                Plusieurs fichiers PMSI peuvent être insérés pour un même Finess et une même période donnée, 
                l'ordre de classement pour prendre en compte le fichier valide consiste à prendre le dernier
                inséré parmi ceux qui n'ont pas été invalidés dans la table d'invalidation.
              <li>Création des tables et outils d'historisation</li>
                Le script <code>Invalisation.sql</code> crée une table listant les RSF ou RSS invalidés, organisés par date.
                La vue V_Admin_RSFHeader_Valides liste les dernières versions utilisées des RSF au moment où la requête est
                effectuée. La requête V_Admin_RSFHeader_getValides renvoie toutes les versions des RSF existants à un moment
                défini comme argument de la fonction, avec leur état : en cours d'utilisation, invalidé (ou ni l'un ni l'autre).
                La vue V_Admin_RSSHeader_Valides liste les dernières versions utilisées des RSS au moment où la requête est
                effectuée. La requête V_Admin_RSSHeader_getValides renvoie toutes les versions des RSS existants à un moment
                défini comme argument de la fonction, avec leur état : en cours d'utilisation, invalidé (ou ni l'un ni l'autre).
              <li>En cas d'erreur au cours de l'exécution du programme</li>
                Les messages d'erreur ne sont pas encore définis de manière correcte. Le fichier de log devrait petre utilisé
                pour tracer toutes les erreurs, sauf l'impossibilité à accéder à ce fichier qui devrait d'afficher sur la
                sortie standard.
        </ol>
    </ol>
    <li>Spécifications techniques</li>
    <ol class="niveau2">
      <li>Liens entre les tables de la base de données</li>
        Les foreign keys permettent de garantir la cohérence des tables. Le principe est le suivant :
          <ol class="standard">
            <li>Sauvegarde du fichier dans la table pmsiinsertion : chaque fichier pour lequel une tentative d'insertion
              dans la base de données est réalisé est enregistré dans cette table. Les champs permettant de définir
              la réussite ou l'échec de l'insertion sont laissés à null et ne seron remplis qu'à la fin du programme</li>
            <li>Selon le type de fichier, l'entête du fichier est enregistrée dans rsfheader ou rssheader, avec un lien
              vers la table pmsiinsertion : </li>
                <ul>
                  <li>Pour les fichiers RSF :</li>
                    <ol>
                      <li>Chaque ligne A du RSF est enregistrée avec un lien vers le fichier entête rsfheader. L'association
                        id de l'entête + numéro de facture doit être unique</li>
                      <li>Les autres lignes sont enregistrées avec un lien vers la ligne A correspondant au numéro de facture,
                        la clef étrangère est une clef multiple associant rsfheaderid et numéro de facture</li>
                    </ol>
                  <li>Pour les fichiers RSS :</li>
                    <ol>
                      <li>Chaque début de ligne (avec diagnostic principal) est enregistré dans la table RSSMain</li>
                      <li>Puis chaque diagnostic associé, documentaire ou acte est enregistré dans la table correspondante
                        avec un lien vers l'identifiant du diagnostic principal associé</li>
                    </ol>
                </ul>
                <li>Si la tentative d'insertion a été une réussite, le statut de l'insertion (réussi ou non) est
                  stocké dans la table pmsiinsertion</li>
              </ol>
          <li>Transformation des données pour sauvegarde dans la base de données</li>
            Les données des fichiers de PMSI sont séparées en 3 groupes :
              <ul>
                <li>numeric : stockée 'null' si vide</li>
                <li>date : stockée 'null' si vide, transformée pour correspondre au format de date (yyyy-MM-dd)</li>
                <li>chaine de caractères : chaine de caractère vide acceptée, pas de valeurs null possibles</li>
              </ul>
    </ol>
  <li>Limitations</li>
    <ol class="niveau2">
      <li>Arguments de la ligne de commande</li>
        Les arguments de la ligne de commande ne sont pas échappés et peuvent entraîner des problèmes de sécurité.
        La présence dans la liste des processus du mot de passe de la base de données peut compromettre sa sécurité.
      <li>Fichiers RSF lus</li>
        <ol class="niveau3">
          <li>Types de fichiers RSF</li>
            Seuls les fichiers RSF postérieurs à mars 2009 sont lus.
          <li>Types de lignes RSF</li>
            Seules les lignes H, A, B, C, H et M sont lues. Il est très facile de rajouter d'autres lignes,
            mais nous n'en avons pas besoin pour le moment.
        </ol>
      <li>Fichiers RSS lus</li>
        <ol class="niveau3">
          <li>Types de fichiers RSS</li>
            Seuls les RSS de type 116 sont lus.
          <li>Types de données RSS</li>
            Pour le moment, l'existence de diagnostics associés, documentaires ou actes n'a pas été testé.
        </ol>
    </ol>
</ol> 

<h2> Schéma de la base de données </h2>
<img src="doc-files/pmsi2sql.png" alt="schéma de la base de données"/>

<h2>Related Documentation</h2>

<h2> License </h2>
Les Bibliothèques utilisées sont sous leurs propres licenses :
<ul>
<li> commons-lang : sous licence Apache (<A href = "http://commons.apache.org/lang/">homepage</A>)
<li> postgresql : sous licence BSD (<A href = "http://jdbc.postgresql.org/license.html">homepage</A>)
<li> args4j : MIT (<A href = "http://java.net/projects/args4j/">homepage</A>)
</ul>
Le présent logiciel est sous license <A href = "http://www.gnu.org/copyleft/gpl.html">GPLv3</A>
<P>

<P>
<DL>
</DL>
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Package</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-use.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-files/index-1.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;PREV PACKAGE&nbsp;
&nbsp;<A HREF="../../../org/aider/pmsi2sql/dbtypes/package-summary.html"><B>NEXT PACKAGE</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html?org/aider/pmsi2sql/package-summary.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="package-summary.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
