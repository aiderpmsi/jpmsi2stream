<?xml version="1.0"?>

<scxml xmlns="http://www.w3.org/2005/07/scxml"
       xmlns:my="http://my.custom-actions.domain/CUSTOM"
       version="1.0"
       initial="test_header">

	<datamodel>
   		<data name="numline" expr="0" />
	</datamodel>

    <state id="test_header">
   
   		<datamodel>
    		<data name="isrsf2012h" expr="false" />
    		<data name="isrss116h" expr="false" />
		</datamodel>
   
    	<onentry>
   		 	<my:numlinewriter/><my:print content="" newline="true" />
			<my:lineinvocator linename="_line_rsf2012header" varname="isrsf2012h" />
			<my:lineinvocator linename="_line_rss116header" varname="isrss116h" />

    		<if cond="isrsf2012h">
				<my:linewriter linename="_line_rsf2012header" />
				<my:print content="" newline="true" />
				<assign name="numline" expr="numline + 1" />
				<send event="'rsf2012h'" />
			<elseif cond="isrss116h" />
				<my:linewriter linename="_line_rss116header" />
				<my:print content="" newline="true" />
				<assign name="numline" expr="numline + 1" />
				<send event="'rss116h'" />
			<else />
                <send event="'none'" />
             </if>
    	</onentry>
    	
    	<transition event="rss116h" target="rss116h" />
    	<transition event="rsf2012h" target="rsf2012h" />
    	<transition event="none" target="headernotfound" />

    </state>
    	
	<state id="rsf2012h">
	
		<initial>
       		<transition target="rsf2012h.entry"/>
        </initial>
	
		<state id="rsf2012h.entry">
	
	   		<datamodel>
    			<data name="isrsf2012a" expr="false" />
    			<data name="isrsf2012b" expr="false" />
    			<data name="isrsf2012c" expr="false" />
    			<data name="isrsf2012h" expr="false" />
    			<data name="isrsf2012l" expr="false" />
    			<data name="isrsf2012m" expr="false" />
    			<data name="iseof" expr="false" />
			</datamodel>

			<onentry>
	   		 	<my:numlinewriter/><my:print content="" newline="true" />
				<my:lineinvocator linename="_line_rsf2012a" varname="isrsf2012a"/>
				<my:lineinvocator linename="_line_rsf2012b" varname="isrsf2012b"/>
				<my:lineinvocator linename="_line_rsf2012c" varname="isrsf2012c"/>
				<my:lineinvocator linename="_line_rsf2012h" varname="isrsf2012h"/>
				<my:lineinvocator linename="_line_rsf2012l" varname="isrsf2012l"/>
				<my:lineinvocator linename="_line_rsf2012m" varname="isrsf2012m"/>
				<my:lineinvocator linename="_line_eof" varname="iseof"/>

				<if cond="isrsf2012a">
    				<my:linewriter linename="_line_rsf2012a" />
		    		<my:print content="" newline="true" />
		    		<assign name="numline" expr="numline + 1" />
       	   		    <send event="'rsf2012a'" />
       	        <elseif cond="isrsf2012b" />
 					<my:linewriter linename="_line_rsf2012b" />
		    		<my:print content="" newline="true" />
  		    		<assign name="numline" expr="numline + 1" />
       	         	<send event="'rsf2012b'" />
             	<elseif cond="isrsf2012c" />
    		    	<my:linewriter linename="_line_rsf2012c" />
		    		<my:print content="" newline="true" />
 		    		<assign name="numline" expr="numline + 1" />
                	<send event="'rsf2012c'" />
             	<elseif cond="isrsf2012h" />
    		    	<my:linewriter linename="_line_rsf2012h" />
		    		<my:print content="" newline="true" />
  		    		<assign name="numline" expr="numline + 1" />
                	<send event="'rsf2012h'" />
             	<elseif cond="isrsf2012l" />
    		    	<my:linewriter linename="_line_rsf2012l" />
		    		<assign name="numline" expr="numline + 1" />
		    		<my:print content="" newline="true" />
                	<send event="'rsf2012l'" />
             	<elseif cond="isrsf2012m" />
    		    	<my:linewriter linename="_line_rsf2012m" />
		    		<my:print content="" newline="true" />
		    		<assign name="numline" expr="numline + 1" />
                	<send event="'rsf2012m'" />
             	<elseif cond="iseof" />
    		    	<my:linewriter linename="_line_eof" />
		    		<my:print content="" newline="true" />
                	<send event="'eof'" />
             	<else />
                	<send event="'none'" />
             	</if>
			</onentry>
	
    		<transition event="rsf2012a" target="rsf2012h.entry" />
    		<transition event="rsf2012b" target="rsf2012h.entry" />
    	 	<transition event="rsf2012c" target="rsf2012h.entry" />
    		<transition event="rsf2012h" target="rsf2012h.entry" />
    		<transition event="rsf2012l" target="rsf2012h.entry" />
    		<transition event="rsf2012m" target="rsf2012h.entry" />
    		<transition event="eof" target="eof" />
    		<transition event="none" target="linenotknown" />
		</state>
	</state>

	<state id="rss116h">
	
		<datamodel>
			<data name="nbdaread" expr="0"/>
			<data name="nbdadread" expr="0"/>
			<data name="nbzaread" expr="0" />
			<data name="nbda" expr="0"/>
			<data name="nbdad" expr="0"/>
			<data name="nbza" expr="0" />
		</datamodel>
	
		<initial>
       		<transition target="rss116h.entry"/>
        </initial>
	
		<state id="rss116h.entry">
	
	   		<datamodel>
				<data name="isrss116main" expr="false" />
    			<data name="iseof" expr="false" />
			</datamodel>

			<onentry>
	   		 	<my:numlinewriter/><my:print content="" newline="true" />
				<my:lineinvocator linename="_line_rss116main" varname="isrss116main"/>
				<my:lineinvocator linename="_line_eof" varname="iseof"/>

				<if cond="isrss116main">
    				<my:linewriter linename="_line_rss116main" />
		    		<my:print content="" newline="true" />
		    		<assign name="numline" expr="numline + 1" />
					<assign name="nbda" expr="_line_rss116main.getnbda()"/>
					<assign name="nbdad" expr="_line_rss116main.getnbdad()"/>
					<assign name="nbza" expr="_line_rss116main.getnbza()"/>
       	   		    <send event="'rss116main'" />
             	<elseif cond="iseof" />
    		    	<my:linewriter linename="_line_eof" />
		    		<my:print content="" newline="true" />
                	<send event="'eof'" />
             	<else />
                	<send event="'none'" />
             	</if>
			</onentry>
	
    		<transition event="rss116main" target="rss116h.main" />
    		<transition event="eof" target="eof" />
    		<transition event="none" target="linenotknown" />
		</state>
		
		<state id="rss116h.main">

			<datamodel>
				<data name="isrss116da" />
				<data name="isrss116dad" />
				<data name="isrss116za" />
				<data name="isrssfinished" />
			</datamodel>

			<onentry>
				<assign name="isrss116da" expr="false" />
				<assign name="isrss116dad" expr="false" />
				<assign name="isrss116za" expr="false" />
				<assign name="isrssfinished" expr="false" />

				<if cond="nbdaread lt nbda">
					<my:lineinvocator linename="_line_rss116da" varname="isrss116da"/>
					<my:print content="testda" newline="true" />
				<elseif cond="nbdadread lt nbdad" />
					<my:lineinvocator linename="_line_rss116dad" varname="isrss116dad"/>			
					<my:print content="testdad" newline="true" />
				<elseif cond="nbzaread lt nbza" />
					<my:lineinvocator linename="_line_rss116za" varname="isrss116za"/>
					<my:print content="testza" newline="true" />
				<elseif cond="(nbdaread eq nbda) and (nbdadread eq nbdad) and (nbzaread eq nbza)" />
					<assign name="isrssfinished" expr="true" />
					<my:print content="equality" newline="true" />
				</if>

				<my:print content="search rss sub line" newline="true" />
				
				<if cond="isrss116da">
					<my:print content="rss116da" newline="true" />
					<my:linewriter linename="_line_rss116da" />
		    		<my:print content="" newline="true" />
					<assign name="nbdaread" expr="nbdaread + 1" />
					<send event="'rss116da'" />
				<elseif cond="isrss116dad" />
					<my:print content="rss116dad" newline="true" />
					<my:linewriter linename="_line_rss116dad" />
		    		<my:print content="" newline="true" />
					<assign name="nbdadread" expr="nbdadread + 1" />
					<send event="'rss116dad'" />
				<elseif cond="isrss116za" />
					<my:print content="rss116za" newline="true" />
					<my:linewriter linename="_line_rss116za" />
		    		<my:print content="" newline="true" />
					<assign name="nbzaread" expr="nbzaread + 1" />
					<send event="'rss116za'" />
				<elseif cond="isrssfinished" />
					<my:print content="rssfinished" newline="true" />
					<send event="'rssfinished'"/>
				<else />
					<send event="'none'" />
				</if>
			</onentry>

    		<transition event="rssfinished" target="rss116h" />
    		<transition event="rss116da" target="rss116h.main" />
    	 	<transition event="rss116dad" target="rss116h.main" />
    		<transition event="rss116za" target="rss116h.main" />
    		<transition event="none" target="linenotknown" />

		</state>
		
	</state>

    <state id="headernotfound" final="true" />
    <state id="linenotknown" final="true" />
    <state id="eof" final="true" />

</scxml>