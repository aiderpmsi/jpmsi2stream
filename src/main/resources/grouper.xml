<?xml version="1.0" encoding="UTF-8" ?>

<scxml xmlns="http://www.w3.org/2005/07/scxml"
	xmlns:my="http://my.custom-actions.domain/CUSTOM"
	version="1.0" initial="group">

	<state id="group">

		<initial>
	    	<transition target="test_cmd28"/>
		</initial>
	
		<!-- TEST IF WE ARE IN CMD 28 -->
		<state id="test_cmd28">
			<onentry>
				<my:fromRss domain="main" get="NbSeances" result="numSeances" pattern="{0}" type="Integer" />
				<if cond="numSeances != 0">
					<send event="'cmd_found'" />
					<else />
					<send event="'cmd_not_found'" />
				</if>
			</onentry>
			
			<transition event="cmd_found" target="process_cmd28" />
			<transition event="cmd_not_found" target="test_cmd27" />
	
		</state>

		<!-- TEST IF WE ARE IN CMD 27 -->
		<state id="test_cmd27">
			<onentry>
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{0}/{1}" result="acte" type="String"/>
				<my:inResource resource="acteclassant" key="27" value="acte" result="acte_cmd27"/>
				<my:inResource resource="classeacte" key="ADC" value="acte" result="acte_adc"/>
				<my:inResource resource="unclassified" key="A-138" value="acte" result="a138"/>
				<if cond="acte_cmd27 gt 0 and acte_adc gt 0">
					<send event="'cmd_27_adc'" />
					<elseif cond="a138 gt 0"/>
					<send event="'a138'" />
					<else />
					<send event="'cmd_not_found'" />
				</if>
			</onentry>
			
			<transition event="cmd_27_adc" target="process_cmd27_adc" />
			<transition event="a138" target="process_cmd27_a138" />
			<transition event="cmd_not_found" target="test_cmd26" /> 
	
		</state>

		<!-- TEST IF WE ARE IN CMD 26 -->
		<state id="test_cmd26">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:inResource resource="unclassified" key="D-130" value="dp" result="d130"/>
				<if cond="d130 gt 0">
					<send event="'cmd_found'" />
					<else />
					<send event="'cmd_not_found'" />
				</if>
			</onentry>
			
			<transition event="cmd_found" target="process_cmd26" />
			<transition event="cmd_not_found" target="test_cmd25" />
	
		</state>

		<!-- TEST IF WE ARE IN CMD 25 -->
		<state id="test_cmd25">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:inResource resource="unclassified" key="D-127" value="dp" result="dpd127"/>
				<my:inResource resource="unclassified" key="D-127" value="da" result="dad127"/>
				<my:inResource resource="unclassified" key="D-128" value="dp" result="dpd128"/>
				<my:inResource resource="unclassified" key="D-128" value="da" result="dad128"/>
				<if cond="(dpd127 gt 0 and dad128 gt 0) or (dpd128 gt 0 and dad127 gt 0)">
					<send event="'cmd_found'" />
					<else />
					<send event="'cmd_not_found'" />
				</if>
			</onentry>
			
			<transition event="cmd_found" target="process_cmd25" />
			<transition event="cmd_not_found" target="post_cmd25" />
	
		</state>

		<!-- POST CMD 25, PREPARE TEST BY INVERTING DP AND DR IF NEEDED (DP Z09 - Z08) -->
		<state id="post_cmd25">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:execute expr="dp.substring(0, 3)" result = "dpclass"/>
				<if cond="(dpclass eq 'Z09' or dpclass eq 'Z08') and not(dr.size() eq 0)">
					<my:execute expr="'1'" result="inversion" />
					<my:toRss set="DP,DR,Inversion" value="dr,dp,inversion" />
				<else />
					<my:execute expr="'0'" result="inversion" />
					<my:toRss set="Inversion" value="inversion" />
				</if>
				<send event="'continue'" />
			</onentry>
			
			<transition event="continue" target="test_cmd15" />
	
		</state>

		<!-- TEST IF WE ARE IN CMD 15 -->
		<state id="test_cmd15">
			<onentry>
				<my:fromRss domain="main" get="DateEntree" pattern="{0}" result="dateentree" type="Calendar"/>
				<my:fromRss domain="main" get="DDN" pattern="{0}" result="ddn" type="Calendar"/>
				<my:fromRss domain="main" get="ModeEntree" pattern="{0}" result="modeentree" type="Integer"/>
				<my:fromRss domain="main" get="PoidsNouveauNe" pattern="{0}" result="poidsnn" type="Integer"/>
				<my:age birthday="ddn" date="dateentree" result="age" type="day"/>
				<my:age birthday="ddn" date="dateentree" result="ageyear" type="year"/>
				<if cond="(age lt 8)" >
						<send event="'cmd_found'"/>
					<elseif cond="(modeentree ge 1 and modeentree le 4) or (modeentree ge 61 and modeentree le 66) or (modeentree ge 71 and modeentree le 76)" />
						<if cond="(age lt 29) or (ageyear lt 1 and poidsnn lt 2500)" >
							<send event="'cmd_found'" />
							<else />
							<send event="'cmd_not_found'" />
						</if>
					<else />
						<send event="'cmd_not_found'" />
				</if>
			</onentry>
			
			<transition event="cmd_found" target="process_cmd15" />
			<transition event="cmd_not_found" target="test_cmd01" />
	
		</state>

		<!-- TEST IF WE ARE IN CMD 01 -->
		<state id="test_cmd01">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:inResource resource="dpclassant" key="CMD-01" value="dp" result="cmd01"/>
				<if cond="cmd01 gt 0" >
						<send event="'cmd_found'"/>
					<else />
						<send event="'cmd_not_found'" />
				</if>
			</onentry>
			
			<transition event="cmd_found" target="process_cmd01" />
			<transition event="cmd_not_found" target="fend" />
	
		</state>

		<!-- WE ARE IN CMD28 -->
		<state id="process_cmd28">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic" />
				<my:inResource resource="unclassified" key="D-145" value="dp" result="d145"/>
				<if cond="d145 gt 0">
				<send event="'d145_found'" />
					<else />
					<my:group erreur="90Z01Z" />
					<send event="'end'" />
				</if>
			</onentry>
			
			<transition event="d145_found" target="process_cmd28_d145" />
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD28 AND D145 -->
		<state id="process_cmd28_d145">
			<onentry>
				<my:fromRss domain="main" get="DP" result="dp" pattern="{0}" type="Diagnostic" />
				<my:inResource resource="unclassified" key="D-113" value="dp" result="d113" />
				<my:inResource resource="unclassified" key="D-114" value="dp" result="d114" />
				<my:inResource resource="unclassified" key="D-063" value="dp" result="d063" />
				<my:inResource resource="unclassified" key="D-142" value="dp" result="d142" />
				<my:inResource resource="unclassified" key="D-143" value="dp" result="d143" />
				<my:inResource resource="unclassified" key="D-139" value="dp" result="d139" />
				<my:inResource resource="unclassified" key="D-047" value="dp" result="d047" />
				<my:inResource resource="unclassified" key="D-054" value="dp" result="d054" />
				<if cond="d113 gt 0" >
					<send event="'d113_found'" />
					<elseif cond="d114 gt 0" />
					<my:group racine="28Z07" gravite="Z"/>
					<send event="'end'" />
					<elseif cond="d063 gt 0" />
					<my:group racine="28Z17" gravite="Z"/>
					<send event="'end'" />
					<elseif cond="d142 gt 0" />
					<send event="'d142_found'" />
					<elseif cond="d143 gt 0" />
					<send event="'d143_found'" />
					<elseif cond="d139 gt 0" />
					<my:group racine="28Z14" gravite="Z"/>
					<send event="'end'" />
					<elseif cond="d047 gt 0" />
					<my:group racine="28Z15" gravite="Z"/>
					<send event="'end'" />
					<elseif cond="d054 gt 0" />
					<my:group racine="28Z16" gravite="Z"/>
					<send event="'end'" />
					<else />
					<my:group erreur="90Z02Z" />
					<send event="'end'" />
				</if>
			</onentry>
			
			<transition event="d113_found" target="process_cmd28_d145_d113" />
			<transition event="d142_found" target="process_cmd28_d145_d142" />
			<transition event="d143_found" target="process_cmd28_d145_d143" />
			<transition event="end" target="end" />

		</state>					
		
		<!-- We are in CMD 28, D-145 and D-113 -->
		<state id="process_cmd28_d145_d113">
			<onentry>
				<my:fromRss domain="main"  get="DP" result="dp" pattern="{0}" type="Diagnostic" />
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{0}/{1}" result="acte" type="String"/>
				<my:inResource resource="unclassified" key="A-180" value="acte" result="a180" />
				<my:inResource resource="unclassified" key="A-181" value="acte" result="a181" />
				<my:inResource resource="unclassified" key="A-234" value="acte" result="a234" />
				<my:inResource resource="unclassified" key="D-030" value="dp" result="d030" />
				<if cond="a180 gt 0" >
					<my:group racine="28Z01" gravite="Z" />
					<send event="'end'" />
					<elseif cond="a181 gt 0" />
					<my:group racine="28Z02" gravite="Z" />
					<send event="'end'" />
					<elseif cond="a234 gt 0" />
					<my:group racine="28Z03" gravite="Z" />
					<send event="'end'" />
					<elseif cond="d030 gt 0" />
					<my:group racine="28Z04" gravite="Z" />
					<send event="'end'" />
					<else />
					<my:group erreur="90Z02Z" />
					<send event="'end'" />
				</if>
			</onentry>
			
			<transition event="end" target="end" />
			
		</state>

		<!-- We are in CMD 28, D-145 and D-142 -->
		<state id="process_cmd28_d145_d142">
			<onentry>
				<my:fromRss domain="main" get="DP" result="dp" pattern="{0}" type="Diagnostic" />
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{1}/{2}" result="acte" type="String"/>
				<my:inResource resource="unclassified" key="A-314" value="acte" result="a314" />
				<my:inResource resource="unclassified" key="A-315" value="acte" result="a315" />
				<my:inResource resource="unclassified" key="A-316" value="acte" result="a316" />
				<my:inResource resource="unclassified" key="A-317" value="dp" result="a317" />
				<if cond="a314 gt 0" >
					<my:group racine="28Z19" gravite="Z" />
					<send event="'end'" />
					<elseif cond="a315 gt 0" />
					<my:group racine="28Z20" gravite="Z"/>
					<send event="'end'" />
					<elseif cond="a316 gt 0" />
					<my:group racine="28Z21" gravite="Z" />
					<send event="'end'" />
					<elseif cond="a317 gt 0" />
					<my:group racine="28Z22" gravite="Z" />
					<send event="'end'" />
					<else />
					<my:group erreur="90Z02Z" />
					<send event="'end'" />
				</if>
			</onentry>

			<transition event="end" target="end" />

		</state>
	
		<!-- We are in CMD 28, D-145 and D-143 -->
		<state id="process_cmd28_d145_d143" >
			<onentry>
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{1}/{2}" result="acte" type="String"/>
				<my:inResource resource="unclassified" key="A-342" value="acte" result="a342" />
				<my:inResource resource="unclassified" key="A-205" value="acte" result="a205" />
				<my:inResource resource="unclassified" key="A-170" value="acte" result="a170" />
				<my:inResource resource="unclassified" key="A-304" value="acte" result="a304" />
				<my:inResource resource="unclassified" key="A-318" value="acte" result="a318" />
				<my:inResource resource="unclassified" key="A-319" value="acte" result="a319" />
				<my:inResource resource="unclassified" key="A-320" value="acte" result="a320" />
				<if cond="a342 gt 0" >
					<send event="'fend'" /> <!-- test_cmd27 -->
					<elseif cond="a205 gt 0" />
					<my:group racine="28Z10" gravite="Z" />
					<send event="'end'" />
					<elseif cond="a170 gt 0" />
					<my:group racine="28Z11" gravite="Z" />
					<send event="'end'" />
					<elseif cond="a304 gt 0" />
					<my:group racine="28Z18" gravite="Z" />
					<send event="'end'" />
					<elseif cond="a318 gt 0" />
					<my:group racine="28Z23" gravite="Z" />
					<send event="'end'" />
					<else />
					<elseif cond="a319 gt 0" />
					<my:group racine="28Z24" gravite="Z" />
					<send event="'end'" />
					<elseif cond="a320 gt 0" />
					<my:group racine="28Z25" gravite="Z" />
					<send event="'end'" />
					<else />
					<my:group erreur="90Z02Z" />
					<send event="'end'" />
				</if>
			</onentry>

			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD27 AND IN ADC -->
		<state id="process_cmd27_adc">
			<onentry>
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{0}/{1}" result="acte" type="String"/>
				<my:inResource resource="unclassified" key="A-139" value="acte" result="a139"/>
				<my:inResource resource="unclassified" key="A-140" value="acte" result="a140"/>
				<my:inResource resource="unclassified" key="A-141" value="acte" result="a141"/>
				<my:inResource resource="unclassified" key="A-027" value="acte" result="a027"/>
				<my:inResource resource="unclassified" key="A-093" value="acte" result="a093"/>
				<my:inResource resource="unclassified" key="A-265" value="acte" result="a265"/>
				<if cond="a139 gt 0">
					<my:group racine="27C02" gravite="1" />
					<send event="'end'" />
					<elseif cond="a140 gt 0"/>
					<my:group racine="27C03" gravite="1" />
					<send event="'end'" />
					<elseif cond="a141 gt 0" />
					<my:group racine="27C04" gravite="1" />
					<send event="'end'" />
					<elseif cond="a027 gt 0" />
					<my:group racine="27C05" gravite="1" />
					<send event="'end'" />
					<elseif cond="a093 gt 0" />
					<my:group racine="27C06" gravite="1" />
					<send event="'end'" />
					<elseif cond="a265 gt 0" />
					<my:group racine="27C07" gravite="1" />
					<send event="'end'" />
					<else />
					<my:group erreur="90Z02Z" />
					<send event="'end'" />
				</if>
			</onentry>
			
			<transition event="end" target="end" />

		</state>
		
		<!-- WE ARE IN CMD27 AND A-138 -->
		<state id="process_cmd27_a138">
			<onentry>
				<my:fromRss domain="main" get="DateEntree" pattern="{0}" result="entree" type="String"/>
				<my:fromRss domain="main" get="DateSortie" pattern="{0}" result="sortie" type="String"/>
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{0}/{1}" result="acte" type="String"/>
				<my:inResource resource="unclassified" key="A-178" value="acte" result="a178"/>
				<if cond="entree eq sortie">
					<my:group racine="27Z04" modalite="J" />
					<send event="'end'" />
					<elseif cond="a178 gt 0"/>
					<my:group racine="27Z02" gravite="1" />
					<send event="'end'" />
					<else />
					<my:group racine="27Z03" gravite="Z" />
					<send event="'end'" />
				</if>
			</onentry>
			
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD26 -->
		<state id="process_cmd26">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-131" value="diags" result="d131"/>
				<my:inResource resource="unclassified" key="D-132" value="diags" result="d132"/>
				<my:inResource resource="unclassified" key="D-133" value="diags" result="d133"/>
				<my:inResource resource="unclassified" key="D-134" value="diags" result="d134"/>
				<my:inResource resource="unclassified" key="D-135" value="diags" result="d135"/>
				<my:inResource resource="unclassified" key="D-136" value="diags" result="d136"/>
				<my:inResource resource="unclassified" key="D-137" value="diags" result="d137"/>
				<my:inResource resource="unclassified" key="D-138" value="diags" result="d138"/>
				<my:execute expr="(d131 gt 0 ? 1:0) + (d132 gt 0 ? 1:0) + (d133 gt 0 ? 1:0) +
				    (d134 gt 0 ? 1:0) + (d135 gt 0 ? 1:0) + (d136 gt 0 ? 1:0) + (d137 gt 0 ? 1:0) + (d138 gt 0 ? 1:0)"  result="numdiags"/>
				<if cond="numdiags ge 2">
					<send event="'2_trauma_diag'" />
					<elseif cond="numdiags le 1"/>
					<send event="'1_trauma_diag'" />
				</if>
			</onentry>
			
			<transition event="2_trauma_diag" target="process_cmd26_2_trauma" />
			<transition event="1_trauma_diag" target="test_cmd25" />

		</state>

		<!-- WE ARE IN CMD26 AND HAVE 2 TRAUMAS -->
		<state id="process_cmd26_2_trauma">
			<onentry>
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{0}/{1}" result="acte" type="String"/>
				<my:inResource resource="classeacte" key="ADC" value="acte" result="acte_adc"/>
				<if cond="acte_adc gt 0">
					<my:group racine="26C02" gravite="1" />
					<send event="'end'" />
					<else />
					<my:group racine="26M02" gravite="1" />
					<send event="'end'" />
				</if>
			</onentry>
			
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD25 -->
		<state id="process_cmd25">
			<onentry>
				<my:fromRss domain="main" get="ModelSortie" pattern="{0}" result="modesortie" type="Integer"/> <!-- ModeSortie 9 is deceased -->
				<my:fromRss domain="main" get="DateEntree" pattern="{0}" result="dateentree" type="Calendar"/>
				<my:fromRss domain="main" get="DDN" pattern="{0}" result="ddn" type="Calendar"/>
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{0}/{1}" result="acte" type="String"/>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:age birthday="ddn" date="dateentree" type="year" result="age" />
				<my:inResource resource="classeacte" key="ADC" value="acte" result="acte_adc"/>
				<my:inResource resource="unclassified" key="D-129" value="diags" result="d129"/>
				<if cond="modesortie eq 9">
					<my:group racine="25Z02" gravite="E" />
					<send event="'end'" />
					<elseif cond="age lt 13"/>
					<my:group racine="25Z03" gravite="1" />
					<send event="'end'" />
					<elseif cond="acte_adc gt 0"/>
					<my:group racine="25C02" gravite="1" />
					<send event="'end'" />
					<elseif cond="d129 ge 2"/>
					<my:group racine="25M02" gravite="C" />
					<send event="'end'" />
					<elseif cond="d129 eq 1"/>
					<my:group racine="25M02" gravite="B" />
					<send event="'end'" />
					<else />
					<my:group racine="25M02" modalite="T" gravite="A" />
					<send event="'end'" />
				</if>
			</onentry>
			
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD15 -->
		<state id="process_cmd15">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{0}/{1}" result="acte" type="String"/>
				<my:fromRss domain="main" get="ModeSortie" pattern="{0}" result="modesortie" type="Integer" />
				<my:fromRss domain="main" get="PoidsNouveauNe" pattern="{0}" result="poidsnn" type="Integer"/>
				<my:fromRss domain="main" get="AgeGestationnel" pattern="{0}" result="agegest" type="Integer"/>
				<my:fromRss domain="main" get="DateEntree" pattern="{0}" result="dateentree" type="Calendar"/>
				<my:fromRss domain="main" get="DateSortie" pattern="{0}" result="datesortie" type="Calendar"/>
				<my:age birthday="dateentree" date="datesortie" result="dureesejour" type="day"/>
				<my:inResource resource="unclassified" key="D-056" value="dp" result="d056" />
				<my:inResource resource="classeacte" key="ADC" value="acte" result="acte_adc" />
				<if cond="d056 gt 0">
						<my:group racine="15Z10" gravite="E" />
						<send event="'end'" />
					<elseif cond="acte_adc gt 0"/>
						<send event="'cmd15_adc'" />
					<elseif cond="modesortie eq 71 and dureesejour lt 4"/>
						<my:group racine="15M02" gravite="Z" />
						<send event="'end'" />
					<elseif cond="modesortie eq 9"/>
						<if cond="dureesejour lt 4">
								<my:group racine="15M03" gravite="E" />
							<else />
								<my:group racine="15M04" gravite="E" />
						</if>
						<send event="'end'" />
					<elseif cond="poidsnn ge 3300 and agegest ge 40"/>
						<send event="cmd15_gnn1" />
					<elseif cond="poidsnn ge 2400 and agegest ge 38"/>
						<send event="cmd15_gnn2" />
					<elseif cond="poidsnn ge 2200 and agegest ge 37"/>
						<send event="cmd15_gnn3" />
					<elseif cond="poidsnn ge 2000 and agegest ge 37"/>
						<send event="cmd15_gnn4" />
					<elseif cond="poidsnn ge 1800 and agegest ge 36"/>
						<send event="cmd15_gnn5" />
					<elseif cond="poidsnn ge 1700 and agegest ge 35"/>
						<send event="cmd15_gnn6" />
					<elseif cond="poidsnn ge 1500 and agegest ge 33"/>
						<send event="cmd15_gnn7" />
					<elseif cond="poidsnn ge 1300 and agegest ge 32"/>
						<send event="cmd15_gnn8" />
					<elseif cond="poidsnn ge 1100 and agegest ge 30"/>
						<send event="cmd15_gnn9" />
					<elseif cond="poidsnn ge 800 and agegest ge 28"/>
						<send event="cmd15_gnn10" />
					<else />
						<my:group racine="90Z02" gravite="Z" />
						<send event="'end'" />
				</if>
			</onentry>
			
			<transition event="end" target="end" />
			<transition event="cmd15_adc" target="process_cmd15_adc" />
			<transition event="cmd15_gnn1" target="process_cmd15_gnn1" />
			<transition event="cmd15_gnn2" target="process_cmd15_gnn2" />
			<transition event="cmd15_gnn3" target="process_cmd15_gnn3" />
			<transition event="cmd15_gnn4" target="process_cmd15_gnn4" />
			<transition event="cmd15_gnn5" target="process_cmd15_gnn5" />
			<transition event="cmd15_gnn6" target="process_cmd15_gnn6" />
			<transition event="cmd15_gnn7" target="process_cmd15_gnn7" />
			<transition event="cmd15_gnn8" target="process_cmd15_gnn8" />
			<transition event="cmd15_gnn9" target="process_cmd15_gnn9" />
			<transition event="cmd15_gnn10" target="process_cmd15_gnn10" />

		</state>

		<!-- WE ARE IN CMD15 AND HAVE AN ADC -->
		<state id="process_cmd15_adc">
			<onentry>
				<my:fromRss domain="main" get="PoidsNouveauNe" pattern="{0}" result="poidsnn" type="Integer"/>
				<my:fromRss domain="main" get="AgeGestationnel" pattern="{0}" result="agegest" type="Integer"/>
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{0}/{1}" result="acte" type="String"/>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-303" value="diags" result="d303"/>
				<my:inResource resource="unclassified" key="A-337" value="acte" result="a337"/>
				<my:inResource resource="unclassified" key="A-338" value="acte" result="a338"/>
				<if cond="poidsnn ge 1500 and agegest ge 33">
					<if cond="a337 gt 0">
						<if cond="d303 gt 0">
							<my:group racine="15C02" gravite="B"/>
						<else />
							<my:group racine="15C02" gravite="A"/>
						</if>
					<elseif cond="a338 gt 0" />
						<if cond="d303 gt 0">
							<my:group racine="15C03" gravite="B"/>
						<else />
							<my:group racine="15C03" gravite="A"/>
						</if>
					<elseif cond="d303 gt 0" />
						<my:group racine="15C05" gravite="B"/>
					<else />
						<my:group racine="15C04" gravite="A"/>
					</if>
					<send event="'end'" />
				<elseif cond="poidsnn ge 1100 and agegest ge 30"/>
					<if cond="d303 gt 0">
						<my:group racine="15C05" gravite="B"/>
					<else />
						<my:group racine="15C05" gravite="A"/>
					</if>
					<send event="'end'" />
				<elseif cond="poidsnn ge 800 and agegest ge 28"/>
					<if cond="d303 gt 0">
						<my:group racine="15C06" gravite="B"/>
					<else />
						<my:group racine="15C06" gravite="A"/>
					</if>
					<send event="'end'" />
				<else />
					<my:group racine="90Z02" gravite="Z" />
					<send event="'end'" />
				</if>
			</onentry>
					
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD15  AND HAVE AN INNATE GROUP 1 -->
		<state id="process_cmd15_gnn1">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-303" value="diags" result="d303"/>
				<my:inResource resource="unclassified" key="D-304" value="diags" result="d304"/>
				<my:inResource resource="unclassified" key="D-305" value="diags" result="d305"/>
				<if cond="d303 gt 0">
					<my:group racine="15M05" gravite="D" />
				<elseif cond="d304 gt 0" />
					<my:group racine="15M05" gravite="C"/>
				<elseif cond="d305 gt 0" />
					<my:group racine="15M05" gravite="B"/>
				<else />
					<my:group racine="15M05" gravite="A"/>
				</if>
				<send event="'end'" />
			</onentry>
					
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD15  AND HAVE AN INNATE GROUP 2 -->
		<state id="process_cmd15_gnn2">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-303" value="diags" result="d303"/>
				<my:inResource resource="unclassified" key="D-304" value="diags" result="d304"/>
				<my:inResource resource="unclassified" key="D-305" value="diags" result="d305"/>
				<if cond="d303 gt 0">
					<my:group racine="15M06" gravite="D" />
				<elseif cond="d304 gt 0" />
					<my:group racine="15M06" gravite="C"/>
				<elseif cond="d305 gt 0" />
					<my:group racine="15M06" gravite="B"/>
				<else />
					<my:group racine="15M06" gravite="A"/>
				</if>
				<send event="'end'" />
			</onentry>
					
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD15  AND HAVE AN INNATE GROUP 3 -->
		<state id="process_cmd15_gnn3">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-306" value="diags" result="d306"/>
				<my:inResource resource="unclassified" key="D-307" value="diags" result="d307"/>
				<if cond="d306 gt 0">
					<my:group racine="15M07" gravite="C"/>
				<elseif cond="d307 gt 0" />
					<my:group racine="15M07" gravite="B"/>
				<else />
					<my:group racine="15M07" gravite="A"/>
				</if>
				<send event="'end'" />
			</onentry>
					
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD15 AND HAVE AN INNATE GROUP 4 -->
		<state id="process_cmd15_gnn4">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-306" value="diags" result="d306"/>
				<my:inResource resource="unclassified" key="D-307" value="diags" result="d307"/>
				<if cond="d306 gt 0">
					<my:group racine="15M08" gravite="C"/>
				<elseif cond="d307 gt 0" />
					<my:group racine="15M08" gravite="B"/>
				<else />
					<my:group racine="15M08" gravite="A"/>
				</if>
				<send event="'end'" />
			</onentry>
					
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD15 AND HAVE AN INNATE GROUP 5 -->
		<state id="process_cmd15_gnn5">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-306" value="diags" result="d306"/>
				<my:inResource resource="unclassified" key="D-307" value="diags" result="d307"/>
				<if cond="d306 gt 0">
					<my:group racine="15M09" gravite="C"/>
				<elseif cond="d307 gt 0" />
					<my:group racine="15M09" gravite="B"/>
				<else />
					<my:group racine="15M09" gravite="A"/>
				</if>
				<send event="'end'" />
			</onentry>
					
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD15 AND HAVE AN INNATE GROUP 6 -->
		<state id="process_cmd15_gnn6">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-306" value="diags" result="d306"/>
				<my:inResource resource="unclassified" key="D-307" value="diags" result="d307"/>
				<if cond="d306 gt 0">
					<my:group racine="15M10" gravite="C"/>
				<elseif cond="d307 gt 0" />
					<my:group racine="15M10" gravite="B"/>
				<else />
					<my:group racine="15M10" gravite="A"/>
				</if>
				<send event="'end'" />
			</onentry>
					
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD15 AND HAVE AN INNATE GROUP 7 -->
		<state id="process_cmd15_gnn7">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-306" value="diags" result="d306"/>
				<my:inResource resource="unclassified" key="D-307" value="diags" result="d307"/>
				<if cond="d306 gt 0">
					<my:group racine="15M11" gravite="C"/>
				<elseif cond="d307 gt 0" />
					<my:group racine="15M11" gravite="B"/>
				<else />
					<my:group racine="15M11" gravite="A"/>
				</if>
				<send event="'end'" />
			</onentry>
					
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD15 AND HAVE AN INNATE GROUP 8 -->
		<state id="process_cmd15_gnn8">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-309" value="diags" result="d309"/>
				<if cond="d309 gt 0">
					<my:group racine="15M12" gravite="B"/>
				<else />
					<my:group racine="15M12" gravite="A"/>
				</if>
				<send event="'end'" />
			</onentry>
					
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD15 AND HAVE AN INNATE GROUP 9 -->
		<state id="process_cmd15_gnn9">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-309" value="diags" result="d309"/>
				<if cond="d309 gt 0">
					<my:group racine="15M13" gravite="B"/>
				<else />
					<my:group racine="15M13" gravite="A"/>
				</if>
				<send event="'end'" />
			</onentry>
					
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD15 AND HAVE AN INNATE GROUP 10 -->
		<state id="process_cmd15_gnn10">
			<onentry>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DR" pattern="{0}" result="dr" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:fromRss domain="dad" get="DAD" pattern="{0}" result="dad" type="Diagnostic"/>
				<my:concatenate values="dp,dr,da,dad" result="diags" />
				<my:inResource resource="unclassified" key="D-309" value="diags" result="d309"/>
				<if cond="d309 gt 0">
					<my:group racine="15M14" gravite="B"/>
				<else />
					<my:group racine="15M14" gravite="A"/>
				</if>
				<send event="'end'" />
			</onentry>
					
			<transition event="end" target="end" />

		</state>

		<!-- WE ARE IN CMD01 -->
		<state id="process_cmd01">
			<onentry>
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{0}/{1}" result="acte" type="String"/>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
				<my:concatenate values="dp,da" result="diags" />
				<my:inResource resource="acteclassant" key="01" value="acte" result="acteclassant"/>
				<if cond="acteclassant gt 0">
					<my:inResource resource="unclassified" key="A-195" value="acte" result="a195" />
					<if cond="a195 gt 0">
						<my:group racine="01C09" gravite="1" />
					<else />
						<my:inResource resource="unclassified" key="A-002" value="acte" result="a002"/>
						<if cond="a002 gt 0" >
							<my:fromRss domain="main" get="DateEntree" pattern="{0}" result="dateentree" type="Calendar"/>
							<my:fromRss domain="main" get="DDN" pattern="{0}" result="ddn" type="Calendar"/>
							<my:age birthday="ddn" date="dateentree" result="age" type="year"/>
							<if cond="age lt 18" >
								<my:inResource resource="unclassified" key="D-039" value="diags" result="d039"/>
								<if cond="d039 gt 0" >
									<my:group racine="01C11" gravite="1" />
								<else />
									<my:group racine="01C12" gravite="1" />
								</if>
							<else />
								<my:inResource resource="unclassified" key="D-092" value="diags" result="d092"/>
								<if cond="d092 gt 0" >
									<my:group racine="01C03" gravite="1" />
								<else />
									<my:group racine="01C04" gravite="1" />
								</if>
							</if>
						<else />
							<my:inResource resource="unclassified" key="A-196" value="acte" result="a196"/>
							<if cond="a196 gt 0">
								<my:group racine="01C10" modalite="J" gravite="1"/>
							<else />
								<my:inResource resource="unclassified" key="A-003" value="acte" result="a003" />
								<if cond="a003 gt 0">
									<my:group racine="01C05" gravite="1" />
								<else />
									<my:inResource resource="unclassified" key="A-004" value="acte" result="a004"/>
									<if cond="a004 gt 0" >
										<my:group racine="01C06" gravite="1" />
									<else />
										<my:inResource resource="unclassified" key="A-346" value="acte" result="a346"/>
										<if cond="a346 gt 0" >
											<my:group racine="01C14" modalite="J" gravite="1"/>
										<else />
											<my:inResource resource="unclassified" key="A-005" value="acte" result="a005"/>
											<my:inResource resource="unclassified" key="D-326" value="dp" result="D326"/>
											<if cond="a005 gt 0 or d326 gt 0" >
												<my:group racine="01C15" gravite="1" modalite="J"/>
											<else />
												<my:inResource resource="unclassified" key="A-006" value="acte" result="a006"/>
												<if cond="a006 gt 0">
													<my:group racine="01C08" modalite="J" gravite="1"/>
												</if>
											</if>
										</if>
									</if>
								</if>
							</if>
						</if>
					</if>
					<send event="'end'" />
				<else />
					<send event="'continue'" />
				</if>
			</onentry>
					
			<transition event="end" target="end" />
			<transition event="continue" target="process_cmd01_step2" />

		</state>

		<!-- STEP 2 of MAIN CMD 01 -->
		<state id="process_cmd01_step2" >
			<onentry>
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{0}/{1}" result="acte" type="String"/>
				<my:inResource resource="actemineurchirreclassant" key="all" value="acte" result="nbacteopreclassant"/>
				<my:inResource resource="classeacte" key="ADC" value="acte" result="nbacteop"/>
				<if cond="nbacteopreclassant eq nbacteop" >
					<my:ignore resource="actemineurchirreclassant" resourcekey="all" domain="acte" domainkey="CodeCCAM,Phase" pattern="{0}/{1}" />
				<else />
					<my:ignore resource="acteclassantop" resourcekey="all" domain="acte" domainkey="CodeCCAM,Phase" pattern="{0}/{1}" />
				</if>
				<send event="'continue'" />
			</onentry>

			<transition event="continue" target="process_cmd01_step3" />
		
		</state>

		<!-- STEP 3 of MAIN CMD 01 -->
		<state id="process_cmd01_step3" >
			<onentry>
				<my:fromRss domain="acte" get="CodeCCAM,Phase" pattern="{0}/{1}" result="acte" type="String"/>
				<my:fromRss domain="acte" get="Activite" pattern="{0}" result="activite" type="Integer"/>
				<my:fromRss domain="main" get="DP" pattern="{0}" result="dp" type="Diagnostic"/>
				<my:fromRss domain="main" get="DateEntree" pattern="{0}" result="dateentree" type="Calendar"/>
				<my:fromRss domain="main" get="DateSortie" pattern="{0}" result="datesortie" type="Calendar"/>
				<my:fromRss domain="main" get="DDN" pattern="{0}" result="ddn" type="Calendar"/>
				<my:fromRss domain="main" get="Inversion" pattern="{0}" result="inversion" type="String"/>
				<my:age birthday="dateentree" date="datesortie" result="duree" type="day"/>
				<my:age birthday="ddn" date="dateentree" result="ageday" type="day"/>
				<my:age birthday="ddn" date="dateentree" result="ageyear" type="year"/>
				<my:fromRss domain="main" get="ModeSortie" pattern="{0}" result="modesortie" type="Integer"/>
				<my:inResource resource="unclassified" key="A-197" value="acte" result="a197"/>
				<my:inResource resource="unclassified" key="A-198" value="acte" result="a198"/>
				<my:inResource resource="unclassified" key="A-266" value="acte" result="a266"/>
				<my:inResource resource="unclassified" key="D-057" value="dp" result="d057"/>
				<my:inResource resource="unclassified" key="D-0101" value="dp" result="d0101"/>
				<my:inResource resource="unclassified" key="D-0102" value="dp" result="d0102"/>
				<my:inResource resource="unclassified" key="D-0103" value="dp" result="d0103"/>
				<my:inResource resource="unclassified" key="D-0104" value="dp" result="d0104"/>
				<my:inResource resource="unclassified" key="D-0105" value="dp" result="d0105"/>
				<my:inResource resource="unclassified" key="D-0106" value="dp" result="d0106"/>
				<my:inResource resource="unclassified" key="D-0107" value="dp" result="d0107"/>
				<my:inResource resource="unclassified" key="D-0108" value="dp" result="d0108"/>
				<my:inResource resource="unclassified" key="D-0109" value="dp" result="d0109"/>
				<my:inResource resource="unclassified" key="D-0110" value="dp" result="d0110"/>
				<my:inResource resource="unclassified" key="D-0111" value="dp" result="d0111"/>
				<my:inResource resource="unclassified" key="D-0112" value="dp" result="d0112"/>
				<my:inResource resource="unclassified" key="D-0113" value="dp" result="d0113"/>
				<my:inResource resource="unclassified" key="D-0114" value="dp" result="d0114"/>
				<my:inResource resource="unclassified" key="D-0115" value="dp" result="d0115"/>
				<my:inResource resource="unclassified" key="D-0116" value="dp" result="d0116"/>
				<my:inResource resource="unclassified" key="D-0117" value="dp" result="d0117"/>
				<my:inResource resource="unclassified" key="D-0118" value="dp" result="d0118"/>
				<my:inResource resource="unclassified" key="D-0119" value="dp" result="d0119"/>
				<my:inResource resource="unclassified" key="D-0120" value="dp" result="d0120"/>
				<my:inResource resource="unclassified" key="D-0121" value="dp" result="d0121"/>
				<my:inResource resource="unclassified" key="D-0122" value="dp" result="d0122"/>
				<my:inResource resource="unclassified" key="D-0123" value="dp" result="d0123"/>
				<my:inResource resource="unclassified" key="D-0124" value="dp" result="d0124"/>
				<my:inResource resource="unclassified" key="D-0125" value="dp" result="d0125"/>
				<my:inResource resource="unclassified" key="D-0126" value="dp" result="d0126"/>
				<my:inResource resource="unclassified" key="D-0127" value="dp" result="d0127"/>
				<if cond="a197 gt 0" >
					<my:inResource resource="unclassified" key="D-067" value="dp" result="d067"/>
					<if cond="d067 gt 0" >
						<my:group racine="01K07" gravite="1"/>
					<else />
						<my:group racine="01K02" gravite="1"/>
					</if>
				<elseif cond="a198 gt 0" />
					<my:group racine="01K03" gravite="1"/>
				<elseif cond="duree lt 2 and modesortie eq 9" />
					<my:inResource resource="unclassified" key="D-064" value="dp" result="d064"/>
					<if cond="d064 gt 0" >
						<my:group racine="01M36" gravite="E"/>
					<else />
						<my:group racine="01M37" gravite="E"/>
					</if>
				<elseif cond="duree eq 0 and a266 gt 0"/>
					<my:group racine="01K04" modalite="J" />
				<elseif cond="duree eq 0 and activite.contains(4)"/>
					<my:group racine="01K06" modalite="J" />
				<elseif cond="inversion eq '1' and d057 gt 0" />
					<my:group racine="01M32" gravite="Z" />
				<elseif cond="d0101 gt 0" />
					<my:group racine="01M22" gravite="1" modalite="T" />
				<elseif cond="d0102 gt 0" />
					<my:group racine="01M23" gravite="1" />
				<elseif cond="d0103 gt 0" />
					<if cond="ageyear lt 18" >
						<my:group racine="01M24" gravite="1" modalite="T"/>
					<else />
						<my:group racine="01M25" gravite="1" modalite="T"/>
					</if>
				<elseif cond="d0104 gt 0" />
					<my:group racine="01M04" gravite="1" modalite="T" />
				<elseif cond="d0105 gt 0" />
					<my:group racine="01M25" gravite="1" modalite="T" />
				<elseif cond="d0106 gt 0" />
					<my:group racine="01M26" gravite="1" modalite="T" />
				<elseif cond="d0107 gt 0" />
					<my:group racine="01M27" gravite="1" modalite="T" />
				<elseif cond="d0108 gt 0" />
					<if cond="ageyear gt 79" >
						<my:group racine="01M07" gravite="1" modalite="T"/>
					<else />
						<my:group racine="01M08" gravite="1" modalite="T"/>
					</if>
				<elseif cond="d0109 gt 0" />
					<my:group racine="01M28" gravite="1" modalite="T" />
				<elseif cond="d0110 gt 0" />
					<my:group racine="01M09" gravite="1" modalite="T" />
				<elseif cond="d0111 gt 0" />
					<my:group racine="01M29" gravite="1" />
				<elseif cond="d0112 gt 0" />
					<my:group racine="01M10" gravite="1" modalite="T" />
				<elseif cond="d0113 gt 0" />
					<my:group racine="01M11" gravite="1" modalite="T" />
				<elseif cond="d0114 gt 0" />
					<my:group racine="01M12" gravite="1" modalite="T" />
				<elseif cond="d0115 gt 0" />
					<my:group racine="01M13" gravite="1" />
				<elseif cond="d0116 gt 0" />
					<my:group racine="01M33" gravite="1" />
				<elseif cond="d0117 gt 0" />
					<my:group racine="01M30" gravite="1" modalite="T" />
				<elseif cond="d0118 gt 0" />
					<my:group racine="01M31" gravite="1" modalite="T" />
				<elseif cond="d0119 gt 0" />
					<if cond="ageyear gt 79" >
						<my:group racine="01M15" gravite="1" modalite="T"/>
					<else />
						<my:group racine="01M16" gravite="1" modalite="T"/>
					</if>
				<elseif cond="d0120 gt 0" />
					<my:group racine="01M17" gravite="1" modalite="T" />
				<elseif cond="d0121 gt 0" />
					<my:fromRss domain="da" get="DA" pattern="{0}" result="da" type="Diagnostic"/>
					<my:concatenate values="dp,da" result="diags"/>
					<my:inResource resource="unclassified" key="D-124" value="diags" result="d124"/>
					<my:inResource resource="unclassified" key="D-125" value="diags" result="d125"/>
					<if cond="d124 gt 0" >
						<my:group racine="01M18" modalite="T" gravite="1" />
					<elseif cond="d125 gt 0" />
						<my:group racine="01M19" gravite="1"/>
					<else />
						<my:group racine="01M20" gravite="1"/>
					</if>
				<elseif cond="d0122 gt 0" />
					<my:inResource resource="unclassified" key="A-267" value="acte" result="a267"/>
					<if cond="duree eq 0 and a267 gt 0" >
						<my:group racine="01K05" modalite="J" />
					<else />
						<my:group racine="01M21" modalite="T" gravite="1" />
					</if>
				<elseif cond="d0123 gt 0" />
					<my:group racine="01M32" gravite="Z" />
				<elseif cond="d0124 gt 0" />
					<my:group racine="01M35" gravite="Z" modalite="T" />
				<elseif cond="d0125 gt 0" />
					<my:group racine="01M34" gravite="Z" modalite="T" />
				<elseif cond="d0126 gt 0" />
					<my:group racine="01M38" gravite="1" />
				<elseif cond="d0127 gt 0" />
					<my:group racine="01M39" gravite="1" />
				</if>
				<send event="'end'" />
			</onentry>

			<transition event="end" target="end" />
		
		</state>

	</state>

	<state id="end" final="true" />

	<state id="fend" finale="true" >
		<onentry>
			<my:group erreur="Fend Stop" />
		</onentry>
	</state>
	
</scxml>